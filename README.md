# Connect Team API

Proxy the Connecteam REST API through typed Next.js App Router endpoints and a lightweight dashboard for exploring time-clock activity.

## Tech Stack

- [Next.js 16](https://nextjs.org/) (App Router + Route Handlers)
- React 19 with server/client components
- Tailwind CSS v4 and [shadcn/ui](https://ui.shadcn.com/) (`components.json` config uses the New York theme with Lucide icons)
- `date-fns` for formatting timestamps in the dashboard

## Project Layout

- `app/api/connect-team/**` – API routes that proxy Connecteam endpoints (`lib/connecteam.ts` centralizes auth + headers).
- `app/time/page.tsx` – Time Clock dashboard that consumes the API routes.
- `components/` & `components/ui/` – UI primitives generated by shadcn.
- `lib/connecteam.ts` – Thin wrapper around `fetch` that injects the base URL and API key.

## Environment Variables

Create a `.env` file (or use your preferred secrets manager) with the following:

| Variable | Required | Description |
| --- | --- | --- |
| `CONNECTTEAM_API_BASE_URL` | ✅ | Base URL for the Connecteam API, e.g. `https://api.connecteam.com`. |
| `CONNECTTEAM_API_KEY` | ✅ | API key for the Connecteam workspace used to authenticate every request. |

The helper in `lib/connecteam.ts` will throw if either variable is missing, so the API routes fail fast during development.

## Getting Started

1. **Install dependencies**
   ```bash
   npm install
   ```
2. **Configure environment**
   ```bash
   cp .env.example .env # if you maintain one
   # otherwise create .env and add the env vars shown above
   ```
3. **Run the development server**
   ```bash
   npm run dev
   ```
   Visit [http://localhost:3000](http://localhost:3000) for the default landing page or [http://localhost:3000/time](http://localhost:3000/time) for the dashboard.

Additional scripts:

| Command | Description |
| --- | --- |
| `npm run build` | Create an optimized production build. |
| `npm run start` | Run the production build locally. |
| `npm run lint` | Execute the ESLint config shipped with Next.js 16. |

## Connecteam Proxy API

All endpoints live under `/api/connect-team` and automatically attach the `X-API-KEY` header plus `Accept: application/json`. Useful routes while iterating in Postman or `curl`:

| Method | Route | Description |
| --- | --- | --- |
| `GET` | `/api/connect-team/me` | Fetches workspace metadata from Connecteam’s `/me`. |
| `GET` | `/api/connect-team/users` | Returns active users from `/users/v1/users`. |
| `GET` | `/api/connect-team/jobs` | Lists jobs from `/jobs/v1/jobs`. |
| `GET` | `/api/connect-team/time/time-clocks` | Lists available time clocks. |
| `GET` | `/api/connect-team/time/time-clocks/[clockId]/users` | Currently returns the first 100 active users (Connecteam does not expose users per clock, so we fetch and cache them alongside clock selection). |
| `GET` | `/api/connect-team/time/time-clocks/[clockId]/time?startDate=YYYY-MM-DD&endDate=YYYY-MM-DD` | Proxies `time-clock/v1/time-clocks/{clockId}/time-activities`, flattens `timeActivitiesByUsers` into one row per shift with `startTimestamp`/`endTimestamp`. |
| `GET` | `/api/connect-team/time/time-sheets` | Example call to `/time-clock/v1/time-clocks/timeClockId/timesheet`; swap in a real clock ID as needed. |

> ℹ️ `startDate` and `endDate` are required for the `time` endpoint; the handler returns a `400` if either query param is missing.

## Time Clock Dashboard (`/time`)

The client-side UI in `app/time/page.tsx` demonstrates how to compose the proxy routes:

1. On load it calls `/api/connect-team/time/time-clocks` and displays each clock in a grid of shadcn `Card`s.
2. Selecting a clock triggers `/api/connect-team/time/time-clocks/[clockId]/users` to populate the sidebar list.
3. Enter a **From** and **To** date (YYYY-MM-DD) and click **Load Time Entries** to call the `time` route. Results render in a simple table with computed durations.
4. User names are resolved locally by matching the user ID returned from the time entries with the cached users array.

This page is intentionally minimal so you can adapt it into internal tooling or verify Connecteam credentials quickly during onboarding.

## Development Notes

- The design system is powered by shadcn/ui; the configuration lives in `components.json` and uses CSS variables defined in `app/globals.css`.
- `app/page.tsx` still contains the stock Next.js welcome screen – feel free to repoint it at the dashboard or marketing copy.
- Because Next.js Route Handlers run on the server, secrets never leave the backend as long as you call these API routes from your client UI or other services.
